openapi: 3.0.3
info:
  title: WASA Photo
  version: 0.0.1
paths: 
  /accounts/{userId}/edit:
    parameters:
    - { $ref: "#/components/parameters/userId" }
    put:
      operationId: setMyUserName
      summary: Updates user account by providing a new username.
      tags: 
      - user settings
      requestBody: 
        content:
          application/json:
            schema: { $ref: "#/components/schemas/username" }
        required: true
      responses:
        '201':
          description: Username changed successfully.
          content:
            application/json:
              schema: { $ref: "#/components/schemas/username" }  
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" }
        
  /users/{username}/profile:
    parameters:
    - $ref: '#/components/parameters/username'
    get: 
      operationId: getUserProfile
      summary: Gets profile of user. 
      tags: 
      - profile
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema: { $ref: "#/components/schemas/profile" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" } 
 
  /users/{username}/photos/:
    parameters:
    - $ref: '#/components/parameters/username'
    post: 
      operationId: uploadPhoto
      summary: Post a photo of the user and so add it to their stream of photos.
      tags: 
        - photos
      requestBody: 
        content:
          image/png:
            schema: { $ref: "#/components/schemas/image" }
        required: true
      responses:
        '201':
          description: Photo uploaded successfully.
          content:
            application/json:
              schema: { $ref: "#/components/schemas/photo" } 
          links:
            GetImageByPhotoId:  
              operationId: getRawImage
              parameters:
                imageId: '$response.body#/photoId'
              description: >
                The `photoId` value returned in the response can be used as
                the `imageId` parameter in `GET /images/{imageId}`.
            GetPhotoByPhotoId:  
              operationId: getPhoto
              parameters:
                photoId: '$response.body#/photoId'
              description: >
                The `photoId` value returned in the response can be used as
                the `photoId` parameter in `GET /users/{username}/photos/{photoId}`.
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" }
  
  /images/{photoId}:
    parameters:
    - $ref: '#/components/parameters/photoId'
    get:
      operationId: getRawImage
      summary: Get the raw image.
      tags: 
      - photos
      responses:
        '200':
          description: Successful operation.
          content:
            image/png: 
              schema: { $ref: "#/components/schemas/image" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" }
  
  /users/{username}/feed:
    parameters:
      - $ref: '#/components/parameters/username'
      - $ref: '#/components/parameters/page'
      - $ref: '#/components/parameters/limit'
      - $ref: '#/components/parameters/sort'
    get: 
      operationId: getMyStream
      summary: Get the photos of the followed users.
      tags: 
      - feed
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema: { $ref: "#/components/schemas/stream" }
          headers:
            Pagination-Count: 
              description: Total number of items
              schema:
                type: integer
            Pagination-Page: 
              description: Current page number
              schema:
                type: integer
            Pagination-Limit: 
              description: Number of returned items
              schema:
                type: integer
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" }
            
  /users/{username}/photos/{photoId}:
    parameters:
    - $ref: '#/components/parameters/username'
    - $ref: '#/components/parameters/photoId'
    get: 
      operationId: getPhoto
      summary: Get the photo uploaded by the user. 
      tags: 
      - photos
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema: { $ref: "#/components/schemas/photo" } 
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" }
    delete: 
      operationId: deletePhoto
      summary: Delete a photo of the user and so remove it from their stream of photos.
      responses:
        '204':
          description: Photo deleted successfully.
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" }
        
  /users/{username}/photos/{photoId}/comments/:
    parameters:
    - $ref: '#/components/parameters/username'
    - $ref: '#/components/parameters/photoId'
    - $ref: '#/components/parameters/page'
    - $ref: '#/components/parameters/limit'
    - $ref: '#/components/parameters/sort'
    get: 
      operationId: getCommentPhoto
      summary: Get comments of a photo of a user specified by username.
      tags: 
      - comments
      parameters: 
      - in: query
        name: commentId
        schema: 
          type: string
        required: false
      responses: 
        "200":
          description: Successfull operation.
          content:
            application/json:
              schema: { $ref: "#/components/schemas/comments" }
          headers:
            Pagination-Count: 
              description: Total number of items
              schema:
                type: integer
            Pagination-Page: 
              description: Current page number
              schema:
                type: integer
            Pagination-Limit: 
              description: Number of returned items
              schema:
                type: integer
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" }  
    post: 
      operationId: commentPhoto
      summary: Post a comment on a photo of a user specified by username.
      tags: 
      - comments
      parameters:
      - in: query
        name: commenterName
        schema:
          type: string 
        required: true 
      requestBody: 
        content:
          application/json:
            schema: { $ref: "#/components/schemas/comment" }
        required: true
      responses: 
        "201":
          description: Comment created successfully.
          content:
            application/json:
              schema: { $ref: "#/components/schemas/comment" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" }
        
  /users/{username}/photos/{photoId}/comments/{commentId}:
    parameters:
    - $ref: '#/components/parameters/username'
    - $ref: '#/components/parameters/photoId'
    - $ref: '#/components/parameters/commentId'
    delete:
      operationId: uncommentPhoto
      summary: Remove a comment.
      tags: 
      - comments
      responses:
        "204": { description: Comment deleted successfully. }
        "400": { $ref: "#/components/responses/BadRequest" }
        "404": { $ref: "#/components/responses/NotFoundError" }
        "500": { $ref: "#/components/responses/InternalServerError" }
  
  /users/{username}/photos/{photoId}/likes/:
    parameters:
    - $ref: '#/components/parameters/username'
    - $ref: '#/components/parameters/photoId'
    - $ref: '#/components/parameters/page'
    - $ref: '#/components/parameters/limit'
    - $ref: '#/components/parameters/sort'
    get: 
      operationId: getLikes
      summary: Get likes of a photo specified by photoId of a user specified by username.
      tags: 
      - likes
      responses: 
        "200":
          description: Successfull operation.
          content:
            application/json:
              schema: { $ref: "#/components/schemas/likes" }
          headers:
            Pagination-Count: 
              description: Total number of items
              schema:
                type: integer
            Pagination-Page: 
              description: Current page number
              schema:
                type: integer
            Pagination-Limit: 
              description: Number of returned items
              schema:
                type: integer
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" } 
        
  /users/{username}/photos/{photoId}/likes/{userId}:
    parameters:
    - $ref: '#/components/parameters/username'
    - $ref: '#/components/parameters/photoId'
    - $ref: '#/components/parameters/userId'
    put: 
      operationId: likePhoto
      summary: Put a like on a photo of a user specified by username. The id of the like is the id of the user who puts the like.
      tags: 
      - likes
      responses: 
        "201":
          description: Like put successfully 
          content:
            application/json:
              schema: { $ref: "#/components/schemas/like" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" }
    delete:
      operationId: unlikePhoto
      summary: Remove a like.
      responses:
        "204": { description: Like removed successfully. }
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" }

  /users/{username}/followers/{followername}:
    parameters:
    - $ref: '#/components/parameters/username'
    - $ref: '#/components/parameters/followername'
    delete:
      operationId: removeFollower
      summary: The user specified by username will remove a follower specified by followername.
      tags: 
      - follower
      responses:
        "204": { description: Follower removed successfully. }
        "400": { $ref: "#/components/responses/BadRequest" }
        "404": { $ref: "#/components/responses/NotFoundError" }
        "500": { $ref: "#/components/responses/InternalServerError" }
  
  /users/{username}/followers/:
    parameters:
    - $ref: '#/components/parameters/username'
    - $ref: '#/components/parameters/page'
    - $ref: '#/components/parameters/limit'
    - $ref: '#/components/parameters/sort'
    get: 
      operationId: getFollowers
      summary: Get followers of a user specified by username.
      tags: 
      - followers
      parameters: 
      - in: query
        name: followername
        schema: 
          $ref: '#/components/schemas/username'
        required: false
      responses: 
        "200":
          description: Successfull operation.
          content:
            application/json:
              schema: { $ref: "#/components/schemas/followers_list" }
          headers:
            Pagination-Count: 
              description: Total number of items
              schema:
                type: integer
            Pagination-Page: 
              description: Current page number
              schema:
                type: integer
            Pagination-Limit: 
              description: Number of returned items
              schema:
                type: integer
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" }  

  /users/{username}/followings/:
    parameters:
    - $ref: '#/components/parameters/username'
    - $ref: '#/components/parameters/page'
    - $ref: '#/components/parameters/limit'
    - $ref: '#/components/parameters/sort'
    get: 
      operationId: getFollowings
      summary: Get followings of a user specified by username.
      tags: 
      - followings
      parameters: 
      - in: query
        name: followingname
        schema: 
          $ref: '#/components/schemas/username'
        required: false
      responses: 
        "200":
          description: Successfull operation.
          content:
            application/json:
              schema: { $ref: "#/components/schemas/followings_list" }
          headers:
            Pagination-Count: 
              description: Total number of items
              schema:
                type: integer
            Pagination-Page: 
              description: Current page number
              schema:
                type: integer
            Pagination-Limit: 
              description: Number of returned items
              schema:
                type: integer
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" }  

  /users/{username}/followings/{followingname}:
    parameters:
    - $ref: '#/components/parameters/username'
    - $ref: '#/components/parameters/followingname'
    put:
      operationId: followUser
      summary: Folllow a user.
      tags:
      - followings
      responses: 
        "201":
          description: User followed successfully.
          content:
            application/json:
              schema: { $ref: "#/components/schemas/following" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "404": { description: User not found. }
        "500": { $ref: "#/components/responses/InternalServerError" }
    delete:
      operationId: unfollowUser
      summary: Unfollow a user.
      responses:
        "204": { description: User unfollowed successfully. }
        "400": { $ref: "#/components/responses/BadRequest" }
        "404": { $ref: "#/components/responses/NotFoundError" }
        "500": { $ref: "#/components/responses/InternalServerError" }

  /users/{username}/bans/:
    parameters:
    - $ref: '#/components/parameters/username'
    - $ref: '#/components/parameters/page'
    - $ref: '#/components/parameters/limit'
    - $ref: '#/components/parameters/sort'
    get:
      operationId: getBans
      summary: Get all users banned by the user username.
      tags: 
      - bans
      parameters: 
      - in: query
        name: bannedname
        schema: 
          type: string
        required: false
      responses: 
        "200":
          description: Successfull operation.
          content:
            application/json:
              schema: { $ref: "#/components/schemas/banned_list" }
          headers:
            Pagination-Count: 
              description: Total number of items
              schema:
                type: integer
            Pagination-Page: 
              description: Current page number
              schema:
                type: integer
            Pagination-Limit: 
              description: Number of returned items
              schema:
                type: integer
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" } 

  /users/{username}/bans/{bannedname}:
    parameters:
    - $ref: '#/components/parameters/username'
    - $ref: '#/components/parameters/bannedname'
    put:
      operationId: banUser
      summary: Ban a user specified by banId.
      tags: 
      - bans
      responses: 
        "200":
          description: User banned successfully.
          content:
            application/json:
              schema: { $ref: "#/components/schemas/banned" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "500": { $ref: "#/components/responses/InternalServerError" } 
    delete:
      operationId: unbanUser
      summary: Unban a user specified by banId.
      tags: 
      - bans
      responses:
          "204": { description: Ban removed successfully. }
          "400": { $ref: "#/components/responses/BadRequest" }
          "404": { $ref: "#/components/responses/NotFoundError" }
          "500": { $ref: "#/components/responses/InternalServerError" }
  /session:
    post:
      tags: ["login"]
      summary: Logs in the user 
      description: |-
            If the user does not exist, it will be created,
            and an identifier is returned.
            If the user exists, the user identifier is returned.
      operationId: doLogin
      requestBody:
        description: User details
        content:
          application/json: 
            schema: { $ref: "#/components/schemas/username" }
        required: true
      responses:
        '201':
          description: User log-in action successful 
          content:
            application/json: 
              schema: { $ref: "#/components/schemas/userId" }
          links:
            GetUserByUserId:  
              operationId: setMyUserName
              parameters:
                userId: '$response.body#/identifier'
              description: >
                The `id` value returned in the response can be used as
                the `userId` parameter in `PUT /accounts/{userId}/edit`.

components:
  securitySchemes:
    bearerAuth:   
      type: http
      scheme: bearer
      bearerFormat: JWT 
  parameters:
    commentId:
      in: path
      name: commentId
      schema: 
        type: string
      required: true
    username: 
      in: path
      name: username 
      schema: 
        $ref: '#/components/schemas/username'
      required: true
    userId: 
      in: path
      name: userId
      schema: 
        $ref: '#/components/schemas/userId'
      required: true
    followername: 
      in: path
      name: followername
      schema: 
        $ref: '#/components/schemas/username'
      required: true
    followingname: 
      in: path
      name: followingname
      schema: 
        $ref: '#/components/schemas/username'
      required: true
    bannedname: 
      in: path
      name: bannedname
      schema: 
        $ref: '#/components/schemas/username'
      required: true
    photoId:
      in: path
      name: photoId
      schema:
        $ref: '#/components/schemas/photoId'
      required: true
    page:
      name: page
      in: query
      description: Current page number
      required: false
      schema: 
        type: integer
        format: int32
        default: 1
        minimum: 1
    limit:
      name: limit
      in: query
      description: Limits the number of returned items
      required: false
      schema: 
        type: integer
        format: int32
        default: 10
        minimum: 10
        maximum: 100
        multipleOf: 10
    sort:
      name: sort
      in: query
      description: Sorting order of items
      required: false
      schema:
        type: string
        default: 'reverse cronological'
  responses:
    BadRequest:
      description: Request was formulated badly. 
      content: 
        application/json:
          schema: 
            $ref: '#/components/schemas/Error'
    InternalServerError:
      description: There is an error in the server.
      content: 
        application/json:
          schema: 
            $ref: '#/components/schemas/Error'
    NotFoundError:
      description: There is an error in the server.
      content: 
        application/json:
          schema: 
            $ref: '#/components/schemas/Error'
  schemas:
    image: 
      type: string 
      format: binary
    photoId:
      type: object
      properties:
        identifier:
          type: string 
    userId: 
      type: object 
      properties:
        identifier:
          type: string
          example: "abcdef012345"
    username: 
      type: object 
      properties:
        name:
          type: string 
          example: Maria 
          pattern: '^.*?$' 
          minLength: 3 
          maxLength: 16
    Error:
      type: object 
      properties:
        description:
          type: string
          minLength: 0
          maxLength: 30
    stream: 
      type: object
      properties: 
        list: 
          type: array 
          items: { $ref: "#/components/schemas/photo" }
          minItems: 1
          maxItems: 100
    photo: 
      type: object
      properties:
        photoId: { $ref: "#/components/schemas/photoId" }
        dateTime: 
          type: string
          format: date-time
        likes: { $ref: "#/components/schemas/likes" }
        comments: { $ref: "#/components/schemas/comments" }
      required: 
      - rawImageId
      - photoId
      - dateTime
      - likes
      - comments
    follower:
      type: object
      properties:
        followerUserName: { $ref: "#/components/schemas/username" }
      required: 
      - followerUserName
    followers_list:
      type: array
      items: { $ref: "#/components/schemas/follower" }
    following:
      type: object
      properties:
        followingUserName: { $ref: "#/components/schemas/username" }
      required: 
      - followingUserName
    followings_list:
      type: array
      items: { $ref: "#/components/schemas/following" }
    banned:
      type: object
      properties:
        bannedUserName: { $ref: "#/components/schemas/username" }
      required: 
      - bannedUserName
    banned_list:
      type: array
      items: { $ref: "#/components/schemas/banned" }
    comment: 
      type: object
      properties: 
        commentId:
          type: object
          properties:
            identifier:
              type: string
          readOnly: true
        commentText:
          type: string 
          minLength: 1
          maxLength: 2200
        commenterUserName: 
          type: string 
          example: Maria 
          pattern: '^.*?$' 
          minLength: 3 
          maxLength: 16
          readOnly: true
      required:
      - id
      - commentText
      - commenterUserName
    comments:
      type: object
      properties:
        number: 
          type: integer
        list:
          type: array 
          items: { $ref: "#/components/schemas/comment" }
          minItems: 1
      required: 
      - number 
      - list
    like: 
      type: object
      properties: 
        id:
          type: string
      required: 
      - id
    likes:
      type: object
      properties:
        number: 
          type: integer
        list:
          type: array 
          items: { $ref: "#/components/schemas/like" }
          minItems: 1
      required: 
      - number
      - list
    profile:  
      type: object
      properties:
        username: { $ref: "#/components/schemas/username" }
        followers:
          description: Number of followers of profile
          type: integer 
        followings:
          description: Number of followings by profile
          type: integer 
        posts:
          description: Number of posts in stream
          type: integer
        stream: { $ref: "#/components/schemas/stream" }
      required: 
      - username
      - followers
      - followings
      - posts
      - stream
security:
  - bearerAuth: []      
